-- This file is part of Eadrax
--
-- Copyright (C) 2009 Eadrax Team
--
-- Eadrax is free software; you can redistribute it and/or
-- modify it under the terms of the GNU General Public License
-- as published by the Free Software Foundation; either version 2
-- of the License, or (at your option) any later version.
-- 
-- Eadrax is distributed in the hope that it will be useful,
-- but WITHOUT ANY WARRANTY; without even the implied warranty of
-- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-- GNU General Public License for more details.

-- You should have received a copy of the GNU General Public License
-- along with Eadrax; if not, write to the Free Software
-- Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.

DROP TABLE IF EXISTS `users`;
CREATE TABLE IF NOT EXISTS `users` (
  `id` int(11) NOT NULL auto_increment,
  `username` varchar(50) NOT NULL,
  `password` varchar(255) NOT NULL,
  `description` text NOT NULL,
  `email` varchar(50) NOT NULL,
  `msn` varchar(50) NOT NULL,
  `gtalk` varchar(50) NOT NULL,
  `yahoo` varchar(50) NOT NULL,
  `skype` varchar(50) NOT NULL,
  `website` varchar(50) NOT NULL,
  `location` varchar(50) NOT NULL,
  `dob` varchar(8) NOT NULL,
  `gender` enum('Unknown','Male','Female') NOT NULL default 'Unknown',
  `avatar` varchar(255) NOT NULL,
  `logtime` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  `level` enum('Normal','Special','Staff','Admin') NOT NULL default 'Normal',
  `lastactive` int(11) NOT NULL,
  PRIMARY KEY  (`id`),
  UNIQUE KEY `username` (`username`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8;

DROP TABLE IF EXISTS `openid`;
CREATE TABLE IF NOT EXISTS `openid` (
  `url` varchar(255) NOT NULL,
  `uid` int(10) NOT NULL,
  PRIMARY KEY  (`url`),
  KEY `uid` (`uid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE `openid`
  ADD CONSTRAINT `openid_ibfk_1` FOREIGN KEY (`uid`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;

DROP TABLE IF EXISTS `categories`;
CREATE TABLE IF NOT EXISTS `categories` (
  `id` int(11) NOT NULL auto_increment,
  `name` varchar(255) NOT NULL,
  PRIMARY KEY  (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8;

INSERT INTO `categories` (`id`, `name`) VALUES
(1, '2D Animation'),
(2, '3D Animation'),
(3, '3D Modeling'),
(4, 'Application Programming'),
(5, 'Digital Paintings'),
(6, 'Documents & Articles'),
(7, 'Games'),
(8, 'Homework'),
(9, 'Interface Design'),
(10, 'Literature & Fiction'),
(11, 'Magazines & Newsletters'),
(12, 'Miscellaneous'),
(13, 'Music'),
(14, 'Posters'),
(15, 'Presentations'),
(16, 'Sound Effects'),
(17, 'Vector Art'),
(18, 'Video'),
(19, 'Website Programming');

DROP TABLE IF EXISTS `projects`;
CREATE TABLE IF NOT EXISTS `projects` (
  `id` int(11) NOT NULL auto_increment,
  `uid` int(11) NOT NULL,
  `cid` int(11) NOT NULL,
  `name` varchar(255) NOT NULL,
  `website` varchar(255) NOT NULL,
  `contributors` varchar(255) NOT NULL,
  `icon` varchar(255) NOT NULL,
  `description` text NOT NULL,
  `logtime` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  PRIMARY KEY  (`id`),
  KEY `uid` (`uid`),
  KEY `cid` (`cid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE `projects`
  ADD CONSTRAINT `projects_ibfk_2` FOREIGN KEY (`cid`) REFERENCES `categories` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `projects_ibfk_1` FOREIGN KEY (`uid`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;

DROP TABLE IF EXISTS `updates`;
CREATE TABLE IF NOT EXISTS `updates` (
  `id` int(11) NOT NULL auto_increment,
  `pid` int(11) NOT NULL,
  `uid` int(11) NOT NULL,
  `summary` varchar(255) NOT NULL,
  `filename` varchar(255) NOT NULL,
  `detail` text NOT NULL,
  `syntax` varchar(255) NOT NULL,
  `pastebin` text NOT NULL,
  `ext` varchar(10) NOT NULL,
  `logtime` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  PRIMARY KEY  (`id`),
  KEY `pid` (`pid`),
  KEY `uid` (`uid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE `updates`
  ADD CONSTRAINT `updates_ibfk_2` FOREIGN KEY (`uid`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `updates_ibfk_1` FOREIGN KEY (`pid`) REFERENCES `projects` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;
